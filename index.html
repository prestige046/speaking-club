<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–†–∞–∑–≥–æ–≤–æ—Ä–Ω—ã–π –∫–ª—É–±</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, sans-serif;
        }
        
        body {
            background: #1c1c1e;
            color: #ffffff;
            padding: 16px;
            padding-bottom: 80px;
            min-height: 100vh;
        }
        
        .profile-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
        }
        
        .profile-name {
            font-size: 28px;
            font-weight: 700;
            color: #ffffff;
        }
        
        .profile-stars {
            display: flex;
            align-items: center;
            gap: 4px;
            color: #8e8e93;
            font-size: 15px;
            margin-top: 4px;
        }
        
        .star-icon {
            color: #ffcc00;
        }
        
        .stats-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #2c2c2e;
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 24px;
        }
        
        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }
        
        .stat-label {
            font-size: 13px;
            color: #8e8e93;
        }
        
        .stat-value {
            font-size: 20px;
            font-weight: 600;
            color: #40a7e3;
        }
        
        .streak-card {
            background: linear-gradient(135deg, #FF6B6B, #FF8E53);
            border-radius: 16px;
            padding: 20px;
            color: white;
            margin-bottom: 24px;
        }
        
        .streak-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }
        
        .streak-header span {
            font-size: 20px;
            font-weight: 600;
        }
        
        .streak-count {
            font-size: 48px;
            font-weight: 700;
            line-height: 1;
        }
        
        .streak-label {
            font-size: 16px;
            opacity: 0.9;
            margin-left: 8px;
        }
        
        .calendar-card {
            background: #2c2c2e;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 24px;
            border: 1px solid #3a3a3c;
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .calendar-title {
            font-size: 18px;
            font-weight: 600;
            color: #ffffff;
        }
        
        .calendar-nav {
            display: flex;
            gap: 16px;
        }
        
        .nav-btn {
            background: #3a3a3c;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #40a7e3;
            padding: 4px 12px;
            border-radius: 8px;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            text-align: center;
        }
        
        .weekday {
            font-size: 13px;
            color: #8e8e93;
            padding: 8px 4px;
        }
        
        .weekend {
            color: #ff6b6b;
        }
        
        .day {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            font-size: 15px;
            border-radius: 50%;
            color: #ffffff;
        }
        
        .day.active {
            background: #40a7e3;
            color: white;
        }
        
        .day.today {
            border: 2px solid #40a7e3;
            color: #40a7e3;
            font-weight: 700;
            background: transparent;
        }
        
        .day.weekend {
            color: #ff6b6b;
        }
        
        .day.active.weekend {
            background: #40a7e3;
            color: white;
        }
        
        .section {
            background: #2c2c2e;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
            border: 1px solid #3a3a3c;
        }
        
        .section-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 16px;
            color: #ffffff;
        }
        
        .referral-box {
            background: #1c1c1e;
            border: 1px solid #3a3a3c;
            border-radius: 12px;
            padding: 14px;
            font-family: monospace;
            font-size: 13px;
            word-break: break-all;
            margin: 16px 0;
            color: #ffffff;
        }
        
        .btn {
            background: #40a7e3;
            color: white;
            border: none;
            border-radius: 12px;
            padding: 14px;
            font-size: 15px;
            font-weight: 600;
            width: 100%;
            cursor: pointer;
        }
        
        .btn.small {
            padding: 8px 12px;
            font-size: 13px;
        }
        
        .btn.outline {
            background: transparent;
            border: 1px solid #40a7e3;
            color: #40a7e3;
        }
        
        .setting-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 0;
            border-bottom: 1px solid #3a3a3c;
        }
        
        .setting-row:last-child {
            border-bottom: none;
        }
        
        .setting-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 2px;
            color: #ffffff;
        }
        
        .setting-desc {
            font-size: 13px;
            color: #8e8e93;
        }
        
        .switch {
            position: relative;
            display: inline-block;
            width: 51px;
            height: 31px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #3a3a3c;
            transition: .2s;
            border-radius: 31px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 27px;
            width: 27px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: .2s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: #40a7e3;
        }
        
        input:checked + .slider:before {
            transform: translateX(20px);
        }
        
        /* –°–ª–æ–≤–∞—Ä—å */
        .word-card {
            background: #1c1c1e;
            border: 1px solid #3a3a3c;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .word-info {
            flex: 1;
        }
        
        .word-text {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 4px;
            color: #ffffff;
        }
        
        .word-translation {
            font-size: 14px;
            color: #8e8e93;
        }
        
        .word-context {
            font-size: 12px;
            color: #40a7e3;
            margin-top: 4px;
            font-style: italic;
        }
        
        .delete-word {
            color: #ff6b6b;
            font-size: 20px;
            padding: 8px;
            cursor: pointer;
            border-radius: 8px;
        }
        
        .delete-word:hover {
            background: #3a3a3c;
        }
        
        .add-word {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
        }
        
        .add-word input {
            flex: 1;
            background: #1c1c1e;
            border: 1px solid #3a3a3c;
            border-radius: 10px;
            padding: 12px;
            color: white;
            font-size: 15px;
        }
        
        .add-word input::placeholder {
            color: #8e8e93;
        }
        
        /* –†–æ–ª–∏ */
        .role-card {
            background: #1c1c1e;
            border: 1px solid #3a3a3c;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: border 0.2s;
        }
        
        .role-card.selected {
            border: 2px solid #40a7e3;
            background: rgba(64, 167, 227, 0.1);
        }
        
        .role-info {
            flex: 1;
        }
        
        .role-name {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
            color: #ffffff;
        }
        
        .role-desc {
            font-size: 13px;
            color: #8e8e93;
        }
        
        .role-icon {
            font-size: 24px;
            margin-right: 12px;
        }
        
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #1c1c1e;
            display: flex;
            justify-content: space-around;
            padding: 10px 16px;
            padding-bottom: calc(10px + env(safe-area-inset-bottom));
            border-top: 1px solid #3a3a3c;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            padding: 8px 16px;
            border-radius: 12px;
        }
        
        .nav-icon {
            font-size: 22px;
            color: #8e8e93;
        }
        
        .nav-label {
            font-size: 11px;
            color: #8e8e93;
        }
        
        .nav-item.active {
            background: #2c2c2e;
        }
        
        .nav-item.active .nav-icon,
        .nav-item.active .nav-label {
            color: #40a7e3;
            font-weight: 600;
        }
        
        .hidden {
            display: none;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #8e8e93;
        }
        
        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }
    </style>
</head>
<body>
    <!-- –ü–†–û–§–ò–õ–¨ -->
    <div id="profile-section">
        <div class="profile-header">
            <div>
                <div class="profile-name">Roman</div>
                <div class="profile-stars">
                    <span class="star-icon">‚≠ê</span> 11
                </div>
            </div>
        </div>
        
        <div class="stats-row">
            <div class="stat-item">
                <div class="stat-label">–ü—Ä–∏–≥–ª–∞—à–µ–Ω–æ</div>
                <div class="stat-value" id="inviteCount">0</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">–°–ª–æ–≤–∞—Ä—å</div>
                <div class="stat-value" id="vocabCount">0</div>
            </div>
        </div>
        
        <div class="streak-card">
            <div class="streak-header">
                <span>üî•</span>
                <span>–°–µ—Ä–∏—è</span>
            </div>
            <div>
                <span class="streak-count" id="currentStreak">0</span>
                <span class="streak-label">–¥–Ω–µ–π</span>
            </div>
        </div>
        
        <div class="calendar-card">
            <div class="calendar-header">
                <span class="calendar-title" id="monthYear">—Ñ–µ–≤—Ä–∞–ª—å 2026 –≥.</span>
                <div class="calendar-nav">
                    <button class="nav-btn" onclick="prevMonth()">‚Üê</button>
                    <button class="nav-btn" onclick="nextMonth()">‚Üí</button>
                </div>
            </div>
            <div class="calendar-grid" id="calendarGrid"></div>
        </div>
    </div>
    
    <!-- –°–õ–û–í–ê–†–¨ -->
    <div id="vocabulary-section" class="hidden">
        <div class="section">
            <div class="section-title">üìö –ú–æ–π —Å–ª–æ–≤–∞—Ä—å</div>
            
            <div class="add-word">
                <input type="text" id="newWord" placeholder="–°–ª–æ–≤–æ –∏–ª–∏ —Ñ—Ä–∞–∑–∞" onkeypress="if(event.key==='Enter') addWord()">
                <button class="btn small" onclick="addWord()" style="width: auto; padding: 0 16px;">‚ûï</button>
            </div>
            
            <div id="wordList">
                <!-- –°–ª–æ–≤–∞ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —Å—é–¥–∞ -->
                <div class="empty-state">
                    <div class="empty-state-icon">üìñ</div>
                    <div>–í–∞—à —Å–ª–æ–≤–∞—Ä—å –ø—É—Å—Ç</div>
                    <div style="font-size: 13px; margin-top: 8px;">–î–æ–±–∞–≤–ª—è–π—Ç–µ —Å–ª–æ–≤–∞, —á—Ç–æ–±—ã –∑–∞–ø–æ–º–∏–Ω–∞—Ç—å –∏—Ö</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- –†–ï–§–ï–†–ê–õ–´ -->
    <div id="referrals-section" class="hidden">
        <div class="section">
            <div class="section-title">üë• –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –¥—Ä—É–∑–µ–π</div>
            <div style="color: #8e8e93; margin-bottom: 16px;">
                –û—Ç–ø—Ä–∞–≤—å —Å—Å—ã–ª–∫—É –¥—Ä—É–∑—å—è–º. –ó–∞ –∫–∞–∂–¥–æ–≥–æ –¥—Ä—É–≥–∞ +50 XP
            </div>
            <div class="referral-box" id="referralLink">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            <button class="btn" onclick="copyReferralLink()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É</button>
            <div style="margin-top: 16px; padding: 12px; background: #1c1c1e; border-radius: 12px; border: 1px solid #3a3a3c;">
                <span style="color: #8e8e93;">–ü—Ä–∏–≥–ª–∞—à–µ–Ω–æ –¥—Ä—É–∑–µ–π: </span>
                <span style="font-weight: 600; color: #40a7e3;" id="referralsCount">0</span>
            </div>
        </div>
    </div>
    
    <!-- –ù–ê–°–¢–†–û–ô–ö–ò (–° –†–û–õ–Ø–ú–ò) -->
    <div id="settings-section" class="hidden">
        <div class="section">
            <div class="section-title">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
            
            <div class="setting-row">
                <div>
                    <div class="setting-title">–ò—Å–ø—Ä–∞–≤–ª—è—Ç—å –æ—à–∏–±–∫–∏</div>
                    <div class="setting-desc">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä–∞–º–º–∞—Ç–∏–∫–∏</div>
                </div>
                <label class="switch">
                    <input type="checkbox" id="correctionsSwitch" onchange="toggleCorrections()">
                    <span class="slider"></span>
                </label>
            </div>
            
            <div class="setting-row">
                <div>
                    <div class="setting-title">üé≠ –†–æ–ª—å —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞</div>
                    <div class="setting-desc" id="selectedRoleDesc">–û–±—ã—á–Ω—ã–π —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫</div>
                </div>
                <button class="btn small outline" onclick="showRoleSelector()" style="width: auto;">
                    –°–º–µ–Ω–∏—Ç—å
                </button>
            </div>
            
            <div class="setting-row">
                <div>
                    <div class="setting-title">üì• –í—ã–≥—Ä—É–∑–∏—Ç—å –¥–∏–∞–ª–æ–≥–∏</div>
                    <div class="setting-desc">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤</div>
                </div>
                <button onclick="exportChat()" style="background: #40a7e3; color: white; border: none; padding: 8px 16px; border-radius: 10px; font-size: 14px; cursor: pointer;">
                    –°–∫–∞—á–∞—Ç—å
                </button>
            </div>
        </div>
    </div>
    
    <!-- –í–´–ë–û–† –†–û–õ–ò (–í–°–ü–õ–´–í–ê–Æ–©–ê–Ø –°–ï–ö–¶–ò–Ø) -->
    <div id="role-selector-section" class="hidden">
        <div class="section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <div class="section-title">üé≠ –í—ã–±–µ—Ä–∏ —Ä–æ–ª—å</div>
                <button onclick="hideRoleSelector()" style="background: none; border: none; color: #40a7e3; font-size: 24px; cursor: pointer;">‚úï</button>
            </div>
            
            <div class="role-card" onclick="selectRole('casual')">
                <div style="display: flex; align-items: center;">
                    <span class="role-icon">üó£Ô∏è</span>
                    <div class="role-info">
                        <div class="role-name">–û–±—ã—á–Ω—ã–π —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫</div>
                        <div class="role-desc">–î—Ä—É–∂–µ–ª—é–±–Ω—ã–π, –±–µ–∑–æ—Ü–µ–Ω–æ—á–Ω—ã–π, –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–π –ø—Ä–∞–∫—Ç–∏–∫–∏</div>
                    </div>
                </div>
                <span id="role-check-casual" style="color: #40a7e3; font-size: 20px;">‚úì</span>
            </div>
            
            <div class="role-card" onclick="selectRole('hr')">
                <div style="display: flex; align-items: center;">
                    <span class="role-icon">üíº</span>
                    <div class="role-info">
                        <div class="role-name">HR-–º–µ–Ω–µ–¥–∂–µ—Ä</div>
                        <div class="role-desc">–°–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–µ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º, –≤–æ–ø—Ä–æ—Å—ã –æ –æ–ø—ã—Ç–µ –∏ –Ω–∞–≤—ã–∫–∞—Ö</div>
                    </div>
                </div>
                <span id="role-check-hr" style="color: #40a7e3; font-size: 20px;"></span>
            </div>
            
            <div class="role-card" onclick="selectRole('restaurant')">
                <div style="display: flex; align-items: center;">
                    <span class="role-icon">üç∑</span>
                    <div class="role-info">
                        <div class="role-name">–†–µ—Å—Ç–æ—Ä–∞–Ω</div>
                        <div class="role-desc">–ó–∞–∫–∞–∑ –µ–¥—ã, –æ–±—â–µ–Ω–∏–µ —Å –æ—Ñ–∏—Ü–∏–∞–Ω—Ç–æ–º, —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º</div>
                    </div>
                </div>
                <span id="role-check-restaurant" style="color: #40a7e3; font-size: 20px;"></span>
            </div>
            
            <div class="role-card" onclick="selectRole('hotel')">
                <div style="display: flex; align-items: center;">
                    <span class="role-icon">üè®</span>
                    <div class="role-info">
                        <div class="role-name">–û—Ç–µ–ª—å</div>
                        <div class="role-desc">–ó–∞—Å–µ–ª–µ–Ω–∏–µ, –∂–∞–ª–æ–±—ã, –∑–∞–∫–∞–∑ —É—Å–ª—É–≥</div>
                    </div>
                </div>
                <span id="role-check-hotel" style="color: #40a7e3; font-size: 20px;"></span>
            </div>
            
            <div class="role-card" onclick="selectRole('airport')">
                <div style="display: flex; align-items: center;">
                    <span class="role-icon">üõ´</span>
                    <div class="role-info">
                        <div class="role-name">–ê—ç—Ä–æ–ø–æ—Ä—Ç</div>
                        <div class="role-desc">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –ø–∞—Å–ø–æ—Ä—Ç–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å, –∑–∞–¥–µ—Ä–∂–∫–∞ —Ä–µ–π—Å–∞</div>
                    </div>
                </div>
                <span id="role-check-airport" style="color: #40a7e3; font-size: 20px;"></span>
            </div>
            
            <div class="role-card" onclick="selectRole('doctor')">
                <div style="display: flex; align-items: center;">
                    <span class="role-icon">üè•</span>
                    <div class="role-info">
                        <div class="role-name">–ë–æ–ª—å–Ω–∏—Ü–∞</div>
                        <div class="role-desc">–û–ø–∏—Å–∞–Ω–∏–µ —Å–∏–º–ø—Ç–æ–º–æ–≤, –∑–∞–ø–∏—Å—å –∫ –≤—Ä–∞—á—É</div>
                    </div>
                </div>
                <span id="role-check-doctor" style="color: #40a7e3; font-size: 20px;"></span>
            </div>
        </div>
    </div>
    
    <!-- –ù–ò–ñ–ù–ï–ï –ú–ï–ù–Æ - 4 –ö–ù–û–ü–ö–ò -->
    <div class="bottom-nav">
        <div class="nav-item active" onclick="showSection('profile')">
            <span class="nav-icon">üë§</span>
            <span class="nav-label">–ü—Ä–æ—Ñ–∏–ª—å</span>
        </div>
        <div class="nav-item" onclick="showSection('vocabulary')">
            <span class="nav-icon">üìö</span>
            <span class="nav-label">–°–ª–æ–≤–∞—Ä—å</span>
        </div>
        <div class="nav-item" onclick="showSection('referrals')">
            <span class="nav-icon">üë•</span>
            <span class="nav-label">–†–µ—Ñ–µ—Ä–∞–ª—ã</span>
        </div>
        <div class="nav-item" onclick="showSection('settings')">
            <span class="nav-icon">‚öôÔ∏è</span>
            <span class="nav-label">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
        </div>
    </div>
    
    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.ready();
        
        let currentDate = new Date();
        let currentYear = currentDate.getFullYear();
        let currentMonth = currentDate.getMonth();
        let userData = {};
        let userVocabulary = [];
        let selectedRole = 'casual';
        
        // –ó–∞–ø—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        tg.sendData(JSON.stringify({action: 'getUserData'}));
        tg.sendData(JSON.stringify({action: 'getVocabulary'}));
        tg.sendData(JSON.stringify({action: 'getRole'}));
        
        // –°–ª—É—à–∞–µ–º –æ—Ç–≤–µ—Ç—ã –æ—Ç –±–æ—Ç–∞
        tg.onEvent('message', function(event) {
            try {
                const data = JSON.parse(event.data);
                if (data && typeof data === 'object') {
                    if (data.action === 'vocabulary') {
                        updateVocabulary(data.words);
                    } else if (data.action === 'role') {
                        updateRole(data.role);
                    } else {
                        updateUI(data);
                    }
                }
            } catch (e) {
                console.log('Error parsing data:', e);
            }
        });
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–æ–≤
        function showSection(section) {
            document.getElementById('profile-section').classList.add('hidden');
            document.getElementById('vocabulary-section').classList.add('hidden');
            document.getElementById('referrals-section').classList.add('hidden');
            document.getElementById('settings-section').classList.add('hidden');
            document.getElementById('role-selector-section').classList.add('hidden');
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            
            if (section === 'profile') {
                document.getElementById('profile-section').classList.remove('hidden');
                document.querySelectorAll('.nav-item')[0].classList.add('active');
            } else if (section === 'vocabulary') {
                document.getElementById('vocabulary-section').classList.remove('hidden');
                document.querySelectorAll('.nav-item')[1].classList.add('active');
            } else if (section === 'referrals') {
                document.getElementById('referrals-section').classList.remove('hidden');
                document.querySelectorAll('.nav-item')[2].classList.add('active');
            } else if (section === 'settings') {
                document.getElementById('settings-section').classList.remove('hidden');
                document.querySelectorAll('.nav-item')[3].classList.add('active');
            }
        }
        
        // ========== –°–õ–û–í–ê–†–¨ ==========
        function addWord() {
            const wordInput = document.getElementById('newWord');
            const word = wordInput.value.trim();
            
            if (word) {
                tg.sendData(JSON.stringify({
                    action: 'addWord',
                    word: word
                }));
                
                // –î–æ–±–∞–≤–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω–æ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                userVocabulary.push({
                    word: word,
                    translation: '...',
                    added: new Date().toISOString()
                });
                renderVocabulary();
                wordInput.value = '';
            }
        }
        
        function deleteWord(word) {
            tg.sendData(JSON.stringify({
                action: 'deleteWord',
                word: word
            }));
            
            userVocabulary = userVocabulary.filter(w => w.word !== word);
            renderVocabulary();
        }
        
        function updateVocabulary(words) {
            userVocabulary = words || [];
            renderVocabulary();
            document.getElementById('vocabCount').innerText = userVocabulary.length;
        }
        
        function renderVocabulary() {
            const wordList = document.getElementById('wordList');
            
            if (userVocabulary.length === 0) {
                wordList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìñ</div>
                        <div>–í–∞—à —Å–ª–æ–≤–∞—Ä—å –ø—É—Å—Ç</div>
                        <div style="font-size: 13px; margin-top: 8px;">–î–æ–±–∞–≤–ª—è–π—Ç–µ —Å–ª–æ–≤–∞, —á—Ç–æ–±—ã –∑–∞–ø–æ–º–∏–Ω–∞—Ç—å –∏—Ö</div>
                    </div>
                `;
                return;
            }
            
            let html = '';
            userVocabulary.slice().reverse().forEach(word => {
                html += `
                    <div class="word-card">
                        <div class="word-info">
                            <div class="word-text">${escapeHtml(word.word)}</div>
                            <div class="word-translation">${word.translation || '...'}</div>
                            ${word.context ? `<div class="word-context">¬´${escapeHtml(word.context)}¬ª</div>` : ''}
                        </div>
                        <span class="delete-word" onclick="deleteWord('${escapeHtml(word.word)}')">‚úï</span>
                    </div>
                `;
            });
            
            wordList.innerHTML = html;
        }
        
        // ========== –†–û–õ–ò ==========
        function showRoleSelector() {
            document.getElementById('settings-section').classList.add('hidden');
            document.getElementById('role-selector-section').classList.remove('hidden');
        }
        
        function hideRoleSelector() {
            document.getElementById('role-selector-section').classList.add('hidden');
            document.getElementById('settings-section').classList.remove('hidden');
        }
        
        function selectRole(role) {
            selectedRole = role;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≥–∞–ª–æ—á–∫–∏
            document.querySelectorAll('[id^="role-check-"]').forEach(el => el.innerHTML = '');
            document.getElementById(`role-check-${role}`).innerHTML = '‚úì';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ
            const roleNames = {
                'casual': '–û–±—ã—á–Ω—ã–π —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫',
                'hr': 'HR-–º–µ–Ω–µ–¥–∂–µ—Ä',
                'restaurant': '–†–µ—Å—Ç–æ—Ä–∞–Ω',
                'hotel': '–û—Ç–µ–ª—å',
                'airport': '–ê—ç—Ä–æ–ø–æ—Ä—Ç',
                'doctor': '–ë–æ–ª—å–Ω–∏—Ü–∞'
            };
            document.getElementById('selectedRoleDesc').innerText = roleNames[role] || role;
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ –±–æ—Ç–∞
            tg.sendData(JSON.stringify({
                action: 'setRole',
                role: role
            }));
            
            hideRoleSelector();
        }
        
        function updateRole(role) {
            selectedRole = role || 'casual';
            selectRole(selectedRole);
        }
        
        // ========== –û–°–¢–ê–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ==========
        function toggleCorrections() {
            const isEnabled = document.getElementById('correctionsSwitch').checked;
            tg.sendData(JSON.stringify({
                action: 'toggleCorrections',
                value: isEnabled
            }));
        }
        
        function exportChat() {
            tg.sendData(JSON.stringify({
                action: 'exportChat'
            }));
            tg.showPopup({
                message: 'üì• –ì–µ–Ω–µ—Ä–∏—Ä—É—é —Ñ–∞–π–ª —Å –∏—Å—Ç–æ—Ä–∏–µ–π...',
                buttons: [{type: 'ok'}]
            });
        }
        
        function copyReferralLink() {
            const link = document.getElementById('referralLink').textContent;
            navigator.clipboard.writeText(link).then(() => {
                tg.showPopup({
                    message: '‚úÖ –°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!',
                    buttons: [{type: 'ok'}]
                });
            });
        }
        
        function escapeHtml(text) {
            if (!text) return '';
            return String(text)
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#039;');
        }
        
        function updateUI(data) {
            userData = data;
            
            document.getElementById('inviteCount').innerText = data.referrals_count || 0;
            document.getElementById('currentStreak').innerText = data.currentStreak || 0;
            document.getElementById('referralsCount').innerText = data.referrals_count || 0;
            
            const switchEl = document.getElementById('correctionsSwitch');
            if (data.corrections !== undefined) {
                switchEl.checked = data.corrections;
            }
            
            if (data.referral_code) {
                const botUsername = 'prestige046_bot';
                const refLink = `https://t.me/${botUsername}?start=ref_${data.referral_code}`;
                document.getElementById('referralLink').innerText = refLink;
            }
            
            renderCalendar(currentYear, currentMonth);
        }
        
        function renderCalendar(year, month) {
            const monthNames = ['—è–Ω–≤–∞—Ä—å', '—Ñ–µ–≤—Ä–∞–ª—å', '–º–∞—Ä—Ç', '–∞–ø—Ä–µ–ª—å', '–º–∞–π', '–∏—é–Ω—å',
                               '–∏—é–ª—å', '–∞–≤–≥—É—Å—Ç', '—Å–µ–Ω—Ç—è–±—Ä—å', '–æ–∫—Ç—è–±—Ä—å', '–Ω–æ—è–±—Ä—å', '–¥–µ–∫–∞–±—Ä—å'];
            document.getElementById('monthYear').innerText = `${monthNames[month]} ${year} –≥.`;
            
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const today = new Date();
            
            let html = '';
            const weekdays = ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'];
            
            weekdays.forEach((day, index) => {
                const weekendClass = (index === 5 || index === 6) ? 'weekend' : '';
                html += `<div class="weekday ${weekendClass}">${day}</div>`;
            });
            
            for (let i = 0; i < (firstDay === 0 ? 6 : firstDay - 1); i++) {
                html += '<div></div>';
            }
            
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const weekday = date.getDay();
                const isWeekend = (weekday === 0 || weekday === 6);
                
                let classes = ['day'];
                if (isWeekend) classes.push('weekend');
                if (userData.activeDays && userData.activeDays.includes(day)) classes.push('active');
                
                const isToday = (year === today.getFullYear() && 
                               month === today.getMonth() && 
                               day === today.getDate());
                if (isToday) classes.push('today');
                
                html += `<div class="${classes.join(' ')}">${day}</div>`;
            }
            
            document.getElementById('calendarGrid').innerHTML = html;
        }
        
        function prevMonth() {
            if (currentMonth === 0) {
                currentYear--;
                currentMonth = 11;
            } else {
                currentMonth--;
            }
            renderCalendar(currentYear, currentMonth);
        }
        
        function nextMonth() {
            if (currentMonth === 11) {
                currentYear++;
                currentMonth = 0;
            } else {
                currentMonth++;
            }
            renderCalendar(currentYear, currentMonth);
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date();
            currentYear = today.getFullYear();
            currentMonth = today.getMonth();
            
            if (!userData.activeDays) {
                userData.activeDays = [];
            }
            
            renderCalendar(currentYear, currentMonth);
        });
    </script>
</body>
</html>
